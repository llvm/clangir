// RUN: cir-opt %s -cir-flatten-cfg="through-mlir=false" -o - | FileCheck --check-prefix=DIRECT %s
// RUN: cir-opt %s -cir-flatten-cfg="through-mlir=true" -o - | FileCheck --check-prefix=THRUMLIR %s

!s32i = !cir.int<s, 32>

module {
  cir.func @needUnifyReturn(%arg0: !s32i) {
    %0 = cir.alloca !s32i, !cir.ptr<!s32i>, ["a", init] {alignment = 4 : i64}
    cir.store %arg0, %0 : !s32i, !cir.ptr<!s32i>
    cir.scope {
      %1 = cir.load %0 : !cir.ptr<!s32i>, !s32i
      cir.switch (%1 : !s32i) {
      cir.case (equal, [#cir.int<3> : !s32i]) {
        cir.return
      ^bb1:  // no predecessors
        cir.break
      }
      cir.yield
      }
    }
    cir.return
  }
// DIRECT-LABEL: cir.func @needUnifyReturn(%arg0: !s32i) {
// DIRECT-COUNT-2:   cir.return
// DIRECT-NOT:   cir.return
// THRUMLIR-LABEL: cir.func @needUnifyReturn(%arg0: !s32i) {
// THRUMLIR-COUNT-1:   cir.return
// THRUMLIR-NOT:   cir.return
}
